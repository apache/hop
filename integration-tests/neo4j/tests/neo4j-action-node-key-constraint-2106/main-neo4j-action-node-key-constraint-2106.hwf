<?xml version="1.0" encoding="UTF-8"?>
<!--
Licensed to the Apache Software Foundation (ASF) under one or more
contributor license agreements.  See the NOTICE file distributed with
this work for additional information regarding copyright ownership.
The ASF licenses this file to You under the Apache License, Version 2.0
(the "License"); you may not use this file except in compliance with
the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.

-->
<workflow>
  <name>main-neo4j-action-node-key-constraint-2106</name>
  <name_sync_with_filename>Y</name_sync_with_filename>
  <description>Main workflow for NODE_KEY constraint test (#2106)</description>
  <extended_description>This workflow tests the NODE_KEY constraint feature (Enterprise-only). It creates test data, creates a NODE_KEY constraint, verifies it, and drops it.</extended_description>
  <workflow_version/>
  <created_user>-</created_user>
  <created_date>2025/12/11 00:00:00.000</created_date>
  <modified_user>-</modified_user>
  <modified_date>2025/12/11 00:00:00.000</modified_date>
  <parameters>
    <parameter>
      <name>TEST_FOLDER</name>
      <default_value>neo4j-action-node-key-constraint-2106</default_value>
      <description/>
    </parameter>
  </parameters>
  <actions>
    <action>
      <name>Start</name>
      <description/>
      <type>SPECIAL</type>
      <attributes/>
      <repeat>N</repeat>
      <schedulerType>0</schedulerType>
      <intervalSeconds>0</intervalSeconds>
      <intervalMinutes>60</intervalMinutes>
      <hour>12</hour>
      <minutes>0</minutes>
      <weekDay>1</weekDay>
      <DayOfMonth>1</DayOfMonth>
      <parallel>N</parallel>
      <xloc>96</xloc>
      <yloc>64</yloc>
      <attributes_hac/>
    </action>
    <action>
      <name>cleanup-database.hwf</name>
      <description/>
      <type>WORKFLOW</type>
      <attributes/>
      <run_configuration>local</run_configuration>
      <filename>${PROJECT_HOME}/tests/shared/cleanup-database.hwf</filename>
      <params_from_previous>N</params_from_previous>
      <exec_per_row>N</exec_per_row>
      <set_logfile>N</set_logfile>
      <logfile/>
      <logext/>
      <add_date>N</add_date>
      <add_time>N</add_time>
      <loglevel>Nothing</loglevel>
      <wait_until_finished>Y</wait_until_finished>
      <follow_abort_remote>N</follow_abort_remote>
      <create_parent_folder>N</create_parent_folder>
      <pass_export>N</pass_export>
      <run_configuration>local</run_configuration>
      <parameters>
        <pass_all_parameters>Y</pass_all_parameters>
      </parameters>
      <set_append_logfile>N</set_append_logfile>
      <parallel>N</parallel>
      <xloc>288</xloc>
      <yloc>64</yloc>
      <attributes_hac/>
    </action>
    <action>
      <name>Create Test Data</name>
      <description>Create test Company nodes with id and name properties</description>
      <type>NEO4J_CYPHER_SCRIPT</type>
      <attributes/>
      <connection>Test</connection>
      <replace_variables>N</replace_variables>
      <script>// Clean up any existing test data
MATCH (c:Company)
WHERE c.id IN ['C001', 'C002', 'C003']
DETACH DELETE c
;

// Create test Company nodes
CREATE (c1:Company { id: 'C001', name: 'Acme Corp', country: 'USA' })
;
CREATE (c2:Company { id: 'C002', name: 'Tech Solutions', country: 'UK' })
;
CREATE (c3:Company { id: 'C003', name: 'Global Inc', country: 'USA' })
;

</script>
      <parallel>N</parallel>
      <xloc>480</xloc>
      <yloc>64</yloc>
      <attributes_hac/>
    </action>
    <action>
      <name>Create NODE_KEY Constraint</name>
      <description>Create a NODE_KEY constraint on Company nodes using id and name properties (comma-separated)</description>
      <type>NEO4J_CONSTRAINT</type>
      <attributes/>
      <connection>Test</connection>
      <updates>
        <update>
          <constraint_type>NODE_KEY</constraint_type>
          <index_name>company_id_name_key</index_name>
          <object_name>Company</object_name>
          <object_properties>id,name</object_properties>
          <object_type>NODE</object_type>
          <update_type>CREATE</update_type>
        </update>
      </updates>
      <parallel>N</parallel>
      <xloc>672</xloc>
      <yloc>64</yloc>
      <attributes_hac/>
    </action>
    <action>
      <name>Verify Constraint</name>
      <description>Verify the constraint was created by querying Neo4j system database</description>
      <type>NEO4J_CYPHER_SCRIPT</type>
      <attributes/>
      <connection>Test</connection>
      <replace_variables>N</replace_variables>
      <script>// Query constraints to verify NODE_KEY was created (Neo4j 5.x syntax)
SHOW CONSTRAINTS
WHERE name = 'company_id_name_key'
;

</script>
      <parallel>N</parallel>
      <xloc>864</xloc>
      <yloc>64</yloc>
      <attributes_hac/>
    </action>
    <action>
      <name>Drop NODE_KEY Constraint</name>
      <description>Drop the NODE_KEY constraint</description>
      <type>NEO4J_CONSTRAINT</type>
      <attributes/>
      <connection>Test</connection>
      <updates>
        <update>
          <constraint_type>NODE_KEY</constraint_type>
          <index_name>company_id_name_key</index_name>
          <object_name>Company</object_name>
          <object_properties>id,name</object_properties>
          <object_type>NODE</object_type>
          <update_type>DROP</update_type>
        </update>
      </updates>
      <parallel>N</parallel>
      <xloc>1056</xloc>
      <yloc>64</yloc>
      <attributes_hac/>
    </action>
  </actions>
  <hops>
    <hop>
      <from>Start</from>
      <to>cleanup-database.hwf</to>
      <enabled>Y</enabled>
      <evaluation>Y</evaluation>
      <unconditional>Y</unconditional>
    </hop>
    <hop>
      <from>cleanup-database.hwf</from>
      <to>Create Test Data</to>
      <enabled>Y</enabled>
      <evaluation>Y</evaluation>
      <unconditional>N</unconditional>
    </hop>
    <hop>
      <from>Create Test Data</from>
      <to>Create NODE_KEY Constraint</to>
      <enabled>Y</enabled>
      <evaluation>Y</evaluation>
      <unconditional>N</unconditional>
    </hop>
    <hop>
      <from>Create NODE_KEY Constraint</from>
      <to>Verify Constraint</to>
      <enabled>Y</enabled>
      <evaluation>Y</evaluation>
      <unconditional>N</unconditional>
    </hop>
    <hop>
      <from>Verify Constraint</from>
      <to>Drop NODE_KEY Constraint</to>
      <enabled>Y</enabled>
      <evaluation>Y</evaluation>
      <unconditional>N</unconditional>
    </hop>
  </hops>
  <notepads>
  </notepads>
  <attributes/>
</workflow>
